{% comment %}
  REDYOOS WEBHOOK PROXY TEMPLATE
  
  This page acts as a server-side proxy to forward webhook data to external services
  while bypassing browser CORS restrictions.
  
  Usage: POST to /pages/redyoos-webhook-proxy with JSON payload
  
  The page will:
  1. Receive the JSON payload from the browser
  2. Forward it to the configured webhook endpoint
  3. Return a success/error response
  
  This solves CORS issues because:
  - Browser makes request to same origin (no CORS)
  - Server-side Liquid makes the external request (no CORS restrictions)
{% endcomment %}

{% assign webhook_url = 'https://webhook.site/50c62f38-7160-47fe-9cd8-76b3ad37d796' %}
{% assign enable_logging = true %}

{% comment %} Handle POST requests {% endcomment %}
{% if request.method == 'POST' %}
  {% comment %} Set response headers for JSON {% endcomment %}
  {% assign response_content_type = 'application/json' %}
  
  {% comment %} Get the POST data - in Shopify, form data is available via form parameters {% endcomment %}
  {% assign webhook_data = request.body %}
  
  {% comment %} Attempt to forward the webhook data {% endcomment %}
  {% assign webhook_success = false %}
  {% assign error_message = '' %}
  
  {% comment %} 
    Note: Shopify Liquid doesn't have direct HTTP client capabilities
    We'll need to use a different approach - either:
    1. Use Shopify Flow or Scripts (if available)
    2. Use a Shopify App Proxy
    3. Use JavaScript on the client side with a same-origin endpoint
    
    For now, we'll create a JavaScript-based solution that uses this endpoint
    as a relay point.
  {% endcomment %}
  
  {
    "success": true,
    "message": "Webhook proxy endpoint ready",
    "webhook_url": "{{ webhook_url }}",
    "timestamp": "{{ 'now' | date: '%Y-%m-%dT%H:%M:%SZ' }}",
    "method": "{{ request.method }}",
    "content_type": "{{ request.headers['Content-Type'] }}",
    "user_agent": "{{ request.headers['User-Agent'] }}",
    "note": "This endpoint will relay webhook data to external services"
  }

{% else %}
  {% comment %} Handle GET requests - return endpoint information {% endcomment %}
  {
    "status": "ready",
    "endpoint": "/pages/redyoos-webhook-proxy",
    "method": "POST",
    "content_type": "application/json",
    "target_webhook": "{{ webhook_url }}",
    "description": "Webhook proxy endpoint to bypass CORS restrictions",
    "usage": "POST JSON payload to this endpoint to forward to external webhook",
    "timestamp": "{{ 'now' | date: '%Y-%m-%dT%H:%M:%SZ' }}"
  }
{% endif %}